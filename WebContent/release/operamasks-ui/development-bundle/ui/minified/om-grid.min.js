(function(b){b.addFlex=function(N,P){if(N.grid){return false}P=b.extend({height:200,width:"auto",striped:true,noVStripe:false,minWidth:30,defaultColWidth:60,minHeight:80,resizable:false,url:false,method:"POST",paged:true,lazyTotalUrl:false,noWrap:true,page:1,total:1,useRp:false,limit:15,rpOptions:[10,15,20,30,50],title:false,pageStat:b.omGrid.lang.pageStat,emptyMsg:b.omGrid.lang.emptyMsg,errorMsg:b.omGrid.lang.errorMsg,minColToggle:1,loadingMsg:b.omGrid.lang.loadingMsg,pageText:b.omGrid.lang.pageText,showToggleBtn:true,buttons:false,toolbar:false,colModel:false,loadMask:true,autoLoad:true,blockOpacity:0.5,preProcess:function(g){return g},onClientSort:true,onDragCol:function(p,g,i){},onToggleCol:function(i,g){},onSuccess:false,onError:function(i,p,g){return},onRowDblClick:function(p,i,g){},onRowClick:function(p,i,g){},onRowSelect:function(g){},onSubmit:false,singleSelect:false,showIndex:false,showCheckbox:false,fillEmptyRows:true,scrollLoad:false},P);P=b.extend({query:"",qtype:""},P);var Y="om-grid om-widget om-widget-content";var k=b("<div></div>").addClass(Y).insertBefore(b(N));if(P.width!="auto"){k.width(P.width);P.width=k.width()}if(P.height!="auto"){k.height(P.height);P.height=k.height()}k.remove();var m=false;if(P.scrollLoad){var f=document.createElement("input");b(f).attr("class","scrollLoad").attr("type","hidden").val(1);b(N).append(f)}if(P.singleSelect){P.showCheckbox=false}if(P.limit=="auto"){P.autoLimit=true}P.dataType="json";b(N).show().attr({cellPadding:0,cellSpacing:0,border:0}).removeAttr("width");var T={hset:{},_rePosDrag:function(){var i=0-this.hDiv.scrollLeft;if(this.hDiv.scrollLeft>0){i-=Math.floor(P.cgwidth/2)}b(T.cDrag).css({top:T.hDiv.offsetTop+1});var g=this.cdpad;b("div",T.cDrag).hide();b("thead tr:first th:visible",this.hDiv).each(function(){var s=b("thead tr:first th:visible",T.hDiv).index(this);var p=parseInt(b(this).width());p=b(this).position().left+p-Math.floor(P.cgwidth/2);b("div:eq("+s+")",T.cDrag).css({left:p+"px"}).show();i=p})},_fixHeight:function(p){p=false;if(!p){p=b(T.bDiv).height()}var t=b(this.hDiv).height();b("div",this.cDrag).each(function(){b(this).height(p+t)});var s=parseInt(b(T.nDiv).height());if(s>p){b(T.nDiv).height(p).width(200)}else{b(T.nDiv).height("auto").width("auto")}b(T.block).css({height:p});var i=T.bDiv.offsetTop+p;if(P.height!="auto"&&P.resizable){i=T.vDiv.offsetTop}b(T.rDiv).css({height:i});var g=(P.height=="auto")?"auto":(P.height-b(T.tDiv).height()-b(T.hDiv).height()-b(T.pDiv).height()-b(T.vDiv).height()-5)+"px";b(T.bDiv).css({height:g});b("div",T.cDrag).css({height:b(T.bDiv).height()+b(T.hDiv).height()})},_dragStart:function(t,s,p){if(t=="colresize"){b(T.nDiv).hide();b(T.nBtn).hide();var w=b("div",this.cDrag).index(p);var g=b("th:visible div:eq("+w+")",this.hDiv).width();b(p).addClass("dragging").siblings().hide();b(p).prev().addClass("dragging").show();this.colresize={startX:s.pageX,ol:parseInt(p.style.left),ow:g,n:w};b("body").css("cursor","col-resize")}else{if(t=="vresize"){var i=false;b("body").css("cursor","row-resize");if(p){i=true;b("body").css("cursor","col-resize")}this.vresize={h:P.height,sy:s.pageY,w:P.width,sx:s.pageX,hgo:i}}else{if(t=="colMove"){b(T.nDiv).hide();b(T.nBtn).hide();this.hset=b(this.hDiv).offset();this.hset.right=this.hset.left+b("table",this.hDiv).width();this.hset.bottom=this.hset.top+b("table",this.hDiv).height();this.dcol=p;this.dcoln=b("th",this.hDiv).index(p);this.colCopy=document.createElement("div");this.colCopy.className="colCopy";this.colCopy.innerHTML=p.innerHTML;if(b.browser.msie){this.colCopy.className="colCopy ie"}b(this.colCopy).css({position:"absolute","float":"left",display:"none",textAlign:p.align});b("body").append(this.colCopy);b(this.cDrag).hide()}}}b("body").noSelect()},_dragMove:function(t){if(this.colresize){var i=this.colresize.n;var ad=t.pageX-this.colresize.startX;var w=this.colresize.ol+ad;var s=this.colresize.ow+ad;if(s>P.minWidth){b("div:eq("+i+")",this.cDrag).css("left",w);this.colresize.nw=s}}else{if(this.vresize){var ae=this.vresize;var ab=t.pageY;var ad=ab-ae.sy;if(!P.defwidth){P.defwidth=P.width}if(P.width!="auto"&&!P.nohresize&&ae.hgo){var ac=t.pageX;var p=ac-ae.sx;var g=ae.w+p;if(g>P.defwidth){this.gDiv.style.width=g+"px";P.width=g}}var aa=ae.h+ad;if((aa>P.minHeight||P.height<P.minHeight)&&!ae.hgo){this.bDiv.style.height=aa+"px";P.height=aa;this._fixHeight(aa)}ae=null}else{if(this.colCopy){b(this.dcol).addClass("thMove").removeClass("thOver om-state-hover");if(t.pageX>this.hset.right||t.pageX<this.hset.left||t.pageY>this.hset.bottom||t.pageY<this.hset.top){b("body").css("cursor","move")}else{b("body").css("cursor","pointer")}b(this.colCopy).css({top:t.pageY+10,left:t.pageX+20,display:"block"})}}}},_dragEnd:function(){if(this.colresize){var i=this.colresize.n;var g=this.colresize.nw;b("th:visible div:eq("+i+")",this.hDiv).css("width",g);b("tr",this.bDiv).each(function(){b("td:visible div:eq("+i+")",this).css("width",g)});this.hDiv.scrollLeft=this.bDiv.scrollLeft;b("div:eq("+i+")",this.cDrag).siblings().show();b(".dragging",this.cDrag).removeClass("dragging");this._rePosDrag();this._fixHeight();this.colresize=false}else{if(this.vresize){this.vresize=false}else{if(this.colCopy){b(this.colCopy).remove();if(this.dcolt!=null){if(this.dcoln>this.dcolt){b("th:eq("+this.dcolt+")",this.hDiv).before(this.dcol)}else{b("th:eq("+this.dcolt+")",this.hDiv).after(this.dcol)}this._switchCol(this.dcoln,this.dcolt);b(this.cdropleft).remove();b(this.cdropright).remove();this._rePosDrag();P.onDragCol(this.dcoln,this.dcolt,P)}this.dcol=null;this.hset=null;this.dcoln=null;this.dcolt=null;this.colCopy=null;b(".thMove",this.hDiv).removeClass("thMove");b(this.cDrag).show()}}}b("body").css("cursor","default");b("body").noSelect(false)},_resizeTo:function(aa,i){this.gDiv.style.width=aa+"px";P.width=aa;this.bDiv.style.height=i+"px";P.height=i;var ab=0;var s=null;var g=P.width=="auto"?b(N).parent().width():P.width;var ac=0,t=0;b("thead tr:first th:visible",T.hDiv).each(function(){var w=b(this);if(w.data("autoExpand")){s=w;t=ac}else{ab+=(w.width()+2)}ac++});if(s){var p=g-ab;if(p<=s.data("autoExpandMin")){p=s.data("autoExpandMin")}if(!P.autoLimit){p-=18}b("th:visible div:eq("+t+")",this.hDiv).css("width",p-17);b("tr",this.bDiv).each(function(){b("td:visible div:eq("+t+")",this).css("width",p-17)})}this._fixHeight(i)},_toggleCol:function(t,p){var i=b("th[axis='col"+t+"']",this.hDiv)[0];var s=b("thead th",T.hDiv).index(i);var g=b("input[value="+t+"]",T.nDiv)[0];if(p==null){p=i.hidden}if(b("input:checked",T.nDiv).length<P.minColToggle&&!p){return false}if(p){i.hidden=false;b(i).show();g.checked=true}else{i.hidden=true;b(i).hide();g.checked=false}b("tbody tr",N).each(function(){if(p){b("td:eq("+s+")",this).show()}else{b("td:eq("+s+")",this).hide()}});this._rePosDrag();P.onToggleCol(t,p);return p},_switchCol:function(i,g){b("tbody tr",N).each(function(){if(i>g){b("td:eq("+g+")",this).before(b("td:eq("+i+")",this))}else{b("td:eq("+g+")",this).after(b("td:eq("+i+")",this))}});if(i>g){b("tr:eq("+g+")",this.nDiv).before(b("tr:eq("+i+")",this.nDiv))}else{b("tr:eq("+g+")",this.nDiv).after(b("tr:eq("+i+")",this.nDiv))}if(b.browser.msie&&b.browser.version<7){b("tr:eq("+g+") input",this.nDiv)[0].checked=true}this.hDiv.scrollLeft=this.bDiv.scrollLeft},_scroll:function(){this.hDiv.scrollLeft=this.bDiv.scrollLeft;this._rePosDrag();if(P.scrollLoad){var g=document.createElement("div");var i=document.createElement("div");b(i).addClass("loadingImg").css("display","block");g.align="center";var p=b(g);p.append(i);p.css({position:"relative",bottom:10});b(this.bDiv).scroll(function(){var t=b(".bDiv").height();var s=b(this)[0].scrollHeight;var w=b(this)[0].scrollTop;if(w+t>=(parseInt(s))){if(!m){m=true;b(".bDiv").append(p);b.ajax({type:P.method,url:P.url,data:[{name:"start",value:P.limit*b("input.scrollLoad",this).val()},{name:"limit",value:P.limit},{name:"_time_stamp_",value:new Date().getTime()}],dataType:P.dataType,success:function(aa,ab){p.detach();if(aa.rows.length>0){T._addData(aa,ab)}else{b(".bDiv").scrollTop(b(".bDiv").scrollTop()-15)}m=false;b(".scrollLoad").val(parseInt(b(".scrollLoad").val())+1)},error:function(aa,ad,ac){try{b(".pPageStat",T.pDiv).html(P.errorMsg);b(".pPageStat",T.pDiv).css("color","red");if(P.loadMask){b(T.block).remove()}if(typeof(P.onError)=="function"){P.onError(aa,ad,ac);p.detach()}}catch(ab){}finally{return false}}})}}})}},_getSelections:function(){var g=[];b("tbody tr",T.bDiv).each(function(){if(b(this).hasClass("om-state-highlight")){g.push(b(this).data("data"))}});return g},_setSelections:function(g,p){if(Object.prototype.toString.call(g)!=="[object Array]"){var i=[];i.push(g);g=i}b("tbody tr",T.bDiv).removeClass("om-state-highlight");b("tbody tr",T.bDiv).each(function(){for(var s=0;s<g.length;s++){if(b(this).find("td[abbr="+p+"]").text()==g[s]){b(this).addClass("om-state-highlight");if(b(this).hasClass("erow")){b(this).removeClass("erow")}}}})},_getButtons:function(){if(P.buttons){return b("div.fbutton span",T.tDiv)}},_addData:function(t,w){if(P.dataType=="json"){t=b.extend({rows:[],page:0,total:0},t)}T.data=t;t=P.preProcess(t);this.loading=false;if(!t){b(".pPageStat",this.pDiv).html(P.errorMsg).css("color","red");return false}P.total=t.total;P.pagelen=t.rows.length;if(P.total==0){if(!P.lazyTotalUrl){b("tr, a, td, div",N).unbind();b(N).empty();P.pages=1;P.page=1;this._buildPager();b(".pPageStat",this.pDiv).html(P.emptyMsg).css("color","red");b(".pReload",this.pDiv).removeClass("loading");if(P.loadMask){b(T.block).remove()}return false}if(t.page>=2){P.pages=t.page+3}else{P.pages=5}}else{P.pages=Math.ceil(P.total/P.limit)}P.page=t.page;if(!P.lazyTotalUrl){b(".pReload",this.pDiv).removeClass("loading")}this._buildPager();var g;if(P.scrollLoad){g=b(".bDiv tbody");if(g.length==0){g=document.createElement("tbody")}}else{g=document.createElement("tbody")}if(P.dataType=="json"){var s=t.rows;if(P.fillEmptyRows&&P.autoLimit){if(s.length<(P.limit+1)){for(var p=s.length;p<P.limit+1;p++){s.push({emptyId:"emptyId"+p})}}}b.each(s,function(aa,ac){var ab=document.createElement("tr");if(aa%2&&P.striped){ab.className="erow"}b("thead tr:first th",T.hDiv).each(function(){var ag=document.createElement("td");var ae=b(this).attr("axis").substr(3);ag.align=this.align;if(ac.emptyId){ag.innerHTML="";b(ag).css("height","25px");b(ab).addClass("emptyTr")}else{if("index"===ae){ag.innerHTML=(P.page-1)*P.limit+aa+1}else{if("checkbox"===ae){ag.innerHTML='<span class="checkbox"/>'}else{if(typeof ac[ae]!="undefined"){ag.innerHTML=(ac[ae]!=null)?ac.cell[ae]:""}else{if(typeof(P.colModel[ae].renderer)=="function"){var af=P.colModel[ae].renderer;var i=af(ac[P.colModel[ae].name],ac);if(typeof(i)!="undefined"){if(P.autoLimit&&typeof(i)=="string"){ag.innerHTML=i.replace(/<br\/>/g,"")}else{ag.innerHTML=i}}}else{if(typeof(ac[P.colModel[ae].name])!="undefined"){if(P.autoLimit&&typeof(ac[P.colModel[ae].name])=="string"){ag.innerHTML=ac[P.colModel[ae].name].replace(/<br\/>/g,"")}else{ag.innerHTML=ac[P.colModel[ae].name]}}}}}}b(ab).data("data",ac)}b(ag).attr("abbr",b(this).attr("abbr"));b(ab).append(ag);ag=null});if(b("thead",this.gDiv).length<1){for(idx=0;idx<cell.length;idx++){var ad=document.createElement("td");if(typeof ac.cell[idx]!="undefined"){ad.innerHTML=(ac.cell[idx]!=null)?ac.cell[idx]:""}else{ad.innerHTML=ac.cell[P.colModel[idx].name]}b(ab).append(ad);ad=null}}b(g).append(ab);ab=null})}b("tr",N).unbind();if(!P.scrollLoad){b(N).empty()}b("th[axis='colcheckbox'] span.selected",T.hDiv).removeClass("selected");b(N).append(g);this._addCellProp();this._addRowProp();this._rePosDrag();g=null;t=null;p=null;if(typeof(P.onSuccess)=="function"){P.onSuccess(t,w)}if(P.loadMask){b(T.block).remove()}this.hDiv.scrollLeft=this.bDiv.scrollLeft;if(b.browser.opera){b(N).css("visibility","visible")}},_sortData:function(aa,w,s){for(var p=0;p<aa.rows.length;p++){if(aa.rows[p].emptyId){aa.rows.splice(p,1);p--}}var s=s||P.sortOrder||"asc";if(typeof(P.onClientSort)=="function"){return P.onClientSort(aa,w,s,T,P)}else{if(P.onClientSort==true){var g=(s=="asc"?1:-1);var t;if(P.colModel){for(var p=0;p<P.colModel.length;p++){if(P.colModel[p].name==w){t=P.colModel[p].renderer;break}}}aa.rows.sort(function(ac,i){var ab=t?t(ac[w],ac):ac[w];var ad=t?t(i[w],i):i[w];if(ab==ad){return 0}else{if(ab<ad){return -1*g}else{return 1*g}}});return aa}}},_changeSort:function(g){if(this.loading){return true}b(T.nDiv).hide();b(T.nBtn).hide();if(P.sortName==b(g).attr("abbr")){if(P.sortOrder=="asc"){P.sortOrder="desc"}else{P.sortOrder="asc"}}else{P.sortOrder="asc"}b(g).addClass("sorted").siblings().removeClass("sorted");b(".sdesc",this.hDiv).removeClass("sdesc");b(".sasc",this.hDiv).removeClass("sasc");b("div",g).addClass("s"+P.sortOrder);P.sortName=b(g).attr("abbr");if(P.onClientSort){T._addData(T._sortData(T.data,P.sortName),"success")}else{this._populate()}},_buildPager:function(){b(".pageLink",this.pDiv).html(this._calculateLink());if(!P.lazyTotalUrl){b(".pcontrol input",this.pDiv).val(P.page);b(".pcontrol span",this.pDiv).html(P.pages);var i=(P.page-1)*P.limit+1;var g=i+P.limit-1;if(P.total<g){g=P.total}var p=P.pageStat;p=p.replace(/{from}/,i);p=p.replace(/{to}/,g);p=p.replace(/{total}/,P.total);b(".pPageStat",this.pDiv).html(p)}else{if(!P.aboutTotal){if(!P.lazyTotalUrl){}b(".pPageStat",this.pDiv).html(b.omGrid.lang.count);this.loading=true;b.ajax({url:P.lazyTotalUrl,method:P.method,dataType:P.dataType,data:[{name:"_time_stamp_",value:new Date().getTime()}],success:function(s){P.aboutTotal=s.total;T._buildAboutPage();b("select",T.pDiv).attr("disabled","")},error:function(s,aa,w){try{if(typeof(P.onError)=="function"){P.onError(s,aa,w)}}catch(t){}finally{return false}}})}else{T._buildAboutPage()}}if(P.useRp&&!P.autoLimit){if(this.loading){b("select",T.pDiv).attr("disabled","disabled")}}},_buildAboutPage:function(){this.loading=false;b(".pReload",this.pDiv).removeClass("loading");var i=(P.page-1)*P.limit+1;var g=i+P.pagelen-1;var p=P.pageStat;p=p.replace(/{from}/,i);p=p.replace(/{to}/,g);p=p.replace(/{total}/,P.aboutTotal);b(".pPageStat",this.pDiv).html(p)},_buildLimitOptions:function(){var i="",p="";for(var g=0;g<P.rpOptions.length;g++){if(P.limit==P.rpOptions[g]){p=" selected='selected'"}else{p=""}i+="<option value='"+P.rpOptions[g]+"'"+p+">"+b.omGrid.lang.perPage+P.rpOptions[g]+b.omGrid.lang.word_1+"</option>"}b(".pGroup:first",T.pDiv).html("<select name='rp'>"+i+"</select>");b("select",T.pDiv).change(function(){if(P.onRpChange){P.onRpChange(+this.value)}else{P.newp=1;P.limit=+this.value;T._populate()}})},_calculateLink:function(){var s=[];if(P.pages<=1){s.push(1)}else{if(P.page<=2){for(var p=1;p<=5&&p<=P.pages;p++){s.push(p)}}else{if(P.pages-P.page<2){var t=(P.pages-5+1)<1?1:(P.pages-5+1);for(var p=t;p<=P.pages;p++){s.push(p)}}else{s=[P.page-2,P.page-1,P.page,P.page+1,P.page+2]}}}var g="";for(var p=0;p<s.length;p++){g=(g+'<a href="javascript:" class="'+(s[p]==P.page?"now-page-link":"")+'">'+s[p]+"</a>")}g=b(g);g.click(function(){T._changePage(b(this).text())});return g},_populate:function(){if(this.loading){return true}if(P.onSubmit){var g=P.onSubmit();if(!g){return false}}if(P.autoLimit){P.limit=Math.floor(b(T.bDiv).height()/26)}this.loading=true;if(!P.url){return false}b(".pPageStat",this.pDiv).html(P.loadingMsg);b(".pReload",this.pDiv).addClass("loading");b(".loading").children().eq(0).removeClass("om-icon om-icon-refresh");b(T.block).css({height:b(T.gDiv).height(),width:b(T.gDiv).width()});if(P.loadMask){b(this.gDiv).prepend(T.block)}if(b.browser.opera){b(N).css("visibility","hidden")}if(P.page>P.pages){P.page=P.pages}if(!P.newp){P.newp=P.page}var p=[{name:"start",value:P.limit*(P.newp-1)},{name:"limit",value:P.paged?P.limit:0},{name:"sortName",value:P.sortName},{name:"sortOrder",value:P.sortOrder},{name:"query",value:P.query},{name:"qtype",value:P.qtype},{name:"_time_stamp_",value:new Date().getTime()}];if(P.params){for(var i=0;i<P.params.length;i++){p[p.length]=P.params[i]}}b.ajax({type:P.method,url:P.url,data:p,dataType:P.dataType,success:function(s,t){if(P.onClientSort&&P.sortName){s=T._sortData(s,P.sortName)}T._addData(s,t)},error:function(s,aa,w){try{b(".pPageStat",T.pDiv).html(P.errorMsg).css("color","red");if(P.loadMask){b(T.block).remove()}b(".pReload",T.pDiv).removeClass("loading");if(typeof(P.onError)=="function"){P.onError(s,aa,w)}}catch(t){}finally{return false}}})},_setParams:function(g){P.params=g||{};P.newp=1;this._populate()},_doSearch:function(){P.query=b("input[name=q]",T.sDiv).val();P.qtype=b("select[name=qtype]",T.sDiv).val();P.newp=1;this._populate()},_changePage:function(i){if(this.loading){return true}switch(i){case"first":P.newp=1;break;case"prev":if(P.page>1){P.newp=parseInt(P.page)-1}break;case"next":if(P.page<P.pages){P.newp=parseInt(P.page)+1}break;case"last":P.newp=P.pages;break;case"input":var g=parseInt(b(".pcontrol input",this.pDiv).val());if(isNaN(g)){g=1}if(g<1){g=1}else{if(g>P.pages){g=P.pages}}b(".pcontrol input",this.pDiv).val(g);P.newp=g;break;default:if(/\d/.test(i)){if(isNaN(g)){g=1}var g=parseInt(i);if(g<1){g=1}else{if(g>P.pages){g=P.pages}}b(".pcontrol input",this.pDiv).val(g);P.newp=g}}if(P.newp==P.page){return false}if(P.changepage){P.changepage(P.newp)}else{this._populate()}},_addCellProp:function(){b("tbody tr td",T.bDiv).each(function(){if(b(this.children).length==0||b(this.children)[0].tagName!="DIV"){var p=document.createElement("div");var t=b("td",b(this).parent()).index(this);var s=b("th:eq("+t+")",T.hDiv).get(0);if(s!=null){if(P.sortName==b(s).attr("abbr")&&P.sortName){this.className="sorted"}b(p).css({textAlign:s.align,width:b("div:first",s)[0].style.width});if(s.hidden){b(this).css("display","none")}}if(P.noWrap==false){b(p).css("white-space","normal")}if(this.innerHTML==""){this.innerHTML="&nbsp;"}p.innerHTML=this.innerHTML;var i=b(this).parent()[0];var g=false;if(i.id){g=i.id.substr(3)}if(s!=null){if(s.process){s.process(p,g)}}b(this).empty().append(p).removeAttr("width")}})},_getCellDim:function(p){var aa=parseInt(b(p).height());var g=parseInt(b(p).parent().height());var t=parseInt(p.style.width);var ac=parseInt(b(p).parent().width());var w=p.offsetParent.offsetTop;var i=p.offsetParent.offsetLeft;var ab=parseInt(b(p).css("paddingLeft"));var s=parseInt(b(p).css("paddingTop"));return{ht:aa,wt:t,top:w,left:i,pdl:ab,pdt:s,pht:g,pwt:ac}},_changeRowState:function(p,i,g){if(i=="hover"){}else{if(i=="erow"){}else{if(i=="highlight"){if(p.hasClass("om-state-highlight")){p.removeClass("om-state-highlight");if(P.singleSelect||!g){p.siblings().removeClass("om-state-highlight");if(P.striped){p.parent().find("tr:odd").addClass("erow")}}else{if(P.striped){p.parent().find("tr:odd").filter(p).addClass("erow")}}}else{p.addClass("om-state-highlight");if(P.singleSelect||!g){p.siblings().removeClass("om-state-highlight");if(P.striped){p.parent().find("tr:odd").addClass("erow")}}p.removeClass("erow")}}}}},_addRowProp:function(){b("tbody tr",T.bDiv).each(function(){var g=b("span.checkbox",b(this).closest("div").siblings(".hDiv"));if(b(this).hasClass("emptyTr")){return}b(this).click(function(s){var p=(s.target||s.srcElement);if(p.href||p.type){return true}var t=P.onRowClick(s,b(this).data("data"),T);if(t===false){return true}T._changeRowState(b(this),"highlight",s.ctrlKey);g.addClass("selected");if(!b(this).hasClass("om-state-highlight")||b(this).siblings().not(".om-state-highlight").not(".emptyTr").length!=0){g.removeClass("selected")}P.onRowSelect(T)}).mousedown(function(p){if(p.shiftKey){b(this).toggleClass("om-state-highlight");g.addClass("selected");if(!b(this).hasClass("om-state-highlight")||b(this).siblings().not(".om-state-highlight").not(".emptyTr").length!=0){g.removeClass("selected")}P.onRowSelect(T);T.multisel=true;this.focus();b(T.gDiv).noSelect()}}).mouseup(function(){if(T.multisel){T.multisel=false;b(T.gDiv).noSelect(false)}}).hover(function(p){if(b(this).hasClass("erow")){b(this).removeClass("erow");b(this).addClass("erow-hover")}b(this).addClass("om-state-hover");if(T.multisel){b(this).toggleClass("om-state-highlight");g.addClass("selected");if(!b(this).hasClass("om-state-highlight")||b(this).siblings().not(".om-state-highlight").not(".emptyTr").length!=0){g.removeClass("selected")}P.onRowSelect(T)}},function(){if(b(this).hasClass("erow-hover")&&!b(this).hasClass("om-state-highlight")){b(this).removeClass("erow-hover");b(this).addClass("erow")}b(this).removeClass("om-state-hover")}).dblclick(function(p){try{P.onRowDblClick(p,b(this).data("data"),T)}catch(p){if(typeof(P.onError)=="function"){P.onError(null,"error",p)}}});if(P.showCheckbox){var i=b(this);b("span.checkbox",this).click(function(p){i.toggleClass("om-state-highlight");g.addClass("selected");if(!i.hasClass("om-state-highlight")||i.siblings().not(".om-state-highlight").not(".emptyTr").length!=0){g.removeClass("selected")}P.onRowSelect(T);p.stopPropagation()})}})},pager:0};if(P.colModel){B=document.createElement("thead");var V=document.createElement("tr");var r=null;var z=P.width=="auto"?b(N).parent().width():P.width;var h=0;if(P.showIndex){var d=document.createElement("th");b(d).attr("axis","colindex");b(d).attr("width",25);b(d).attr("align","center");b(V).append(b(d));h+=37}if(P.showCheckbox){var d=document.createElement("th");d.innerHTML='<span class="checkbox"/>';b(d).attr("axis","colcheckbox");b(d).attr("width",17);b(d).attr("align","center");b(V).append(b(d));h+=29}for(var R=0;R<P.colModel.length;R++){var C=P.colModel[R];var d=document.createElement("th");d.innerHTML=C.header;if(C.sortable){b(d).attr("sortable",true)}if(C.name){b(d).attr("abbr",C.name)}b(d).attr("axis","col"+R);if(C.align){d.align=C.align}if(C.width){if(C.width=="autoExpand"){if(r){throw b.omGrid.lang.throw_msg_1}r=b(d);r.data("autoExpandMin",C.autoExpandMin||P.defaultColWidth)}else{b(d).attr("width",C.width);if(!C.hide){h+=(C.width+12)}}}else{b(d).attr("width",P.defaultColWidth);if(!C.hide){h+=(P.defaultColWidth+12)}}if(C.hide){d.hidden=true}if(C.process){d.process=C.process}b(V).append(d)}if(r){var L=z-h;if(L<=r.data("autoExpandMin")){L=r.data("autoExpandMin")}if(!P.autoLimit){L-=18}r.attr("width",L-17);r.data("autoExpand","yes");r.data("autoExpandMin",r.data("autoExpandMin"))}b(B).append(V);b(N).prepend(B)}T.gDiv=document.createElement("div");T.mDiv=document.createElement("div");T.hDiv=document.createElement("div");T.bDiv=document.createElement("div");T.vDiv=document.createElement("div");T.rDiv=document.createElement("div");T.cDrag=document.createElement("div");T.block=document.createElement("div");T.nDiv=document.createElement("div");T.nBtn=document.createElement("div");T.iDiv=document.createElement("div");T.tDiv=document.createElement("div");T.sDiv=document.createElement("div");T.pDiv=document.createElement("div");if(!P.paged||P.scrollLoad){T.pDiv.style.display="none"}T.hTable=document.createElement("table");T.gDiv.className=Y;if(P.width!="auto"){T.gDiv.style.width=P.width+"px"}if(b.browser.msie){b(T.gDiv).addClass("ie")}if(P.noVStripe){b(T.gDiv).addClass("novstripe")}b(N).before(T.gDiv);b(T.gDiv).append(N);if(P.buttons){T.tDiv.className="tDiv om-widget-header";var W=document.createElement("div");W.className="tDiv2";for(var R=0;R<P.buttons.length;R++){var J=P.buttons[R];if(!J.separator){var I=document.createElement("div");I.className="fbutton";if(J.icon||J.imgclass){I.innerHTML=" <div> <span class='tbIcon'></span><span class='tbText'>"+J.name+"</span></div>";J.icon&&b("span.tbIcon",I).css("background-image",'url("'+J.icon+'")');J.imgclass&&b("span.tbIcon",I).addClass(J.imgclass)}else{I.innerHTML=" <div><span class='tbText'>"+J.name+"</span></div>"}if(J.bclass){b("span",I).addClass(J.bclass)}I.click=J.click;I.name=J.name;if(J.click){b(I).click(function(){this.click(this.name,T,b(I).find("span").get(0))})}b(W).append(I);if(b.browser.msie&&b.browser.version<7){b(I).hover(function(){b(this).addClass("fbOver")},function(){b(this).removeClass("fbOver")})}}else{b(W).append("<div class='btnseparator'></div>")}}b(T.tDiv).append(W);b(T.tDiv).append("<div style='clear:both'></div>");b(T.gDiv).prepend(T.tDiv)}if(P.toolbar){if(!b("#"+P.toolbar)){return}T.tDiv.className="tDiv om-widget-header";var W=b("#"+P.toolbar);b(T.tDiv).append(W.clone(true).addClass("tDiv2"));W.remove();b(T.gDiv).prepend(T.tDiv)}T.hDiv.className="hDiv om-state-default";b(N).before(T.hDiv);T.hTable.cellPadding=0;T.hTable.cellSpacing=0;b(T.hDiv).append('<div class="hDivBox"></div>');b("div",T.hDiv).append(T.hTable);var B=b("thead:first",N).get(0);if(B){b(T.hTable).append(B)}B=null;var H=0;b("thead tr:first th",T.hDiv).each(function(){var g=document.createElement("div");if(b(this).attr("sortable")&&!P.scrollLoad){b(this).click(function(p){if(!b(this).hasClass("thOver")){b(this).addClass("thOver om-state-hover");return false}var i=(p.target||p.srcElement);if(i.href||i.type){return true}T._changeSort(this)});if(b(this).attr("abbr")==P.sortName){this.className="sorted";g.className="s"+P.sortOrder}}if(this.hidden){b(this).hide()}if(!P.colModel){b(this).attr("axis","col"+H++)}b(g).css({textAlign:this.align,height:"16px",width:this.width+"px"});b(g).addClass("checkboxheader");g.innerHTML=this.innerHTML;b(this).empty().append(g).removeAttr("width").mousedown(function(p){var i=b(this).attr("axis");if(i=="colindex"||i=="colcheckbox"){return}T._dragStart("colMove",p,this)}).hover(function(){var w=b(this).attr("axis");if(w=="colindex"||w=="colcheckbox"){return}if(!T.colresize&&!b(this).hasClass("thMove")&&!T.colCopy){b(this).addClass("thOver om-state-hover")}if(b(this).attr("abbr")!=P.sortName&&!T.colCopy&&!T.colresize&&b(this).attr("sortable")){b("div",this).addClass("s"+P.sortOrder)}else{if(b(this).attr("abbr")==P.sortName&&!T.colCopy&&!T.colresize&&b(this).attr("abbr")){var ab=(P.sortOrder=="asc")?"desc":"asc";b("div",this).removeClass("s"+P.sortOrder).addClass("s"+ab)}}if(T.colCopy){var ac=b("th",T.hDiv).index(this);if(ac==T.dcoln){return false}if(ac<T.dcoln){b(this).append(T.cdropleft)}else{b(this).append(T.cdropright)}T.dcolt=ac}else{if(!T.colresize){var s=b("th:visible",T.hDiv).index(this);var aa=parseInt(b("div:eq("+s+")",T.cDrag).css("left"));var p=jQuery(T.nBtn).outerWidth();var i=aa-p+Math.floor(P.cgwidth/2);b(T.nDiv).hide();b(T.nBtn).hide();b(T.nBtn).css({left:i,top:T.hDiv.offsetTop}).show();var t=parseInt(b(T.nDiv).width());b(T.nDiv).css({top:T.bDiv.offsetTop-3});if((i+t)>b(T.gDiv).width()){b(T.nDiv).css("left",aa-t+1)}else{b(T.nDiv).css("left",i)}if(b(this).hasClass("sorted")){b(T.nBtn).addClass("srtd")}else{b(T.nBtn).removeClass("srtd")}}}},function(){b(this).removeClass("thOver om-state-hover");if(b(this).attr("abbr")!=P.sortName){b("div",this).removeClass("s"+P.sortOrder)}else{if(b(this).attr("abbr")==P.sortName){var i=(P.sortOrder=="asc")?"desc":"asc";b("div",this).addClass("s"+P.sortOrder).removeClass("s"+i)}}if(T.colCopy){b(T.cdropleft).remove();b(T.cdropright).remove();T.dcolt=null}})});if(P.showCheckbox){b("thead tr:first span.checkbox",T.hDiv).click(function(){b(this).toggleClass("selected");if(b(this).hasClass("selected")){b("tbody tr",T.bDiv).filter(function(){return !b(this).hasClass("emptyTr")}).addClass("om-state-highlight")}else{b("tbody tr",T.bDiv).removeClass("om-state-highlight")}P.onRowSelect(T)})}T.bDiv.className="bDiv";b(N).before(T.bDiv);b(T.bDiv).css({height:(P.height=="auto")?"auto":P.height+"px"}).scroll(function(g){T._scroll()}).append(N);if(P.height=="auto"){b("table",T.bDiv).addClass("autoht")}T._addCellProp();T._addRowProp();var j=b("thead tr:first th:first",T.hDiv).get(0);if(j!=null){T.cDrag.className="cDrag";T.cdpad=0;T.cdpad+=(isNaN(parseInt(b("div",j).css("borderLeftWidth")))?0:parseInt(b("div",j).css("borderLeftWidth")));T.cdpad+=(isNaN(parseInt(b("div",j).css("borderRightWidth")))?0:parseInt(b("div",j).css("borderRightWidth")));T.cdpad+=(isNaN(parseInt(b("div",j).css("paddingLeft")))?0:parseInt(b("div",j).css("paddingLeft")));T.cdpad+=(isNaN(parseInt(b("div",j).css("paddingRight")))?0:parseInt(b("div",j).css("paddingRight")));T.cdpad+=(isNaN(parseInt(b(j).css("borderLeftWidth")))?0:parseInt(b(j).css("borderLeftWidth")));T.cdpad+=(isNaN(parseInt(b(j).css("borderRightWidth")))?0:parseInt(b(j).css("borderRightWidth")));T.cdpad+=(isNaN(parseInt(b(j).css("paddingLeft")))?0:parseInt(b(j).css("paddingLeft")));T.cdpad+=(isNaN(parseInt(b(j).css("paddingRight")))?0:parseInt(b(j).css("paddingRight")));b(T.bDiv).before(T.cDrag);var e=b(T.bDiv).height();var y=b(T.hDiv).height();b(T.cDrag).css({top:-y+"px"});b("thead tr:first th",T.hDiv).each(function(){var g=document.createElement("div");b(T.cDrag).append(g);if(!P.cgwidth){P.cgwidth=b(g).width()}b(g).css({height:e+y});if("colcheckbox"==b(this).attr("axis")){b(g).addClass("checkboxcol");return}if("colindex"==b(this).attr("axis")){b(g).addClass("indexcol");return}b(g).mousedown(function(i){T._dragStart("colresize",i,this)});if(b.browser.msie&&b.browser.version<7){T._fixHeight(b(T.gDiv).height());b(g).hover(function(){T._fixHeight();b(this).addClass("dragging")},function(){if(!T.colresize){b(this).removeClass("dragging")}})}})}if(P.striped){b("tbody tr:odd",T.bDiv).addClass("erow")}if(P.resizable&&P.height!="auto"){T.vDiv.className="vGrip";b(T.vDiv).mousedown(function(g){T._dragStart("vresize",g)}).html("<span></span>");b(T.bDiv).after(T.vDiv)}if(P.resizable&&P.width!="auto"&&!P.nohresize){T.rDiv.className="hGrip";b(T.rDiv).mousedown(function(g){T._dragStart("vresize",g,true)}).html("<span></span>").css("height",b(T.gDiv).height());if(b.browser.msie&&b.browser.version<7){b(T.rDiv).hover(function(){b(this).addClass("hgOver")},function(){b(this).removeClass("hgOver")})}b(T.gDiv).append(T.rDiv)}if(P.paged){T.pDiv.className="pDiv om-state-default";T.pDiv.innerHTML='<div class="pDiv2"></div>';b(T.bDiv).after(T.pDiv);var Z='<div class="btnseparator"/>';var n='<div class="pGroup"><div class="pFirst pButton"><span class="om-icon om-icon-seek-start"></span></div><div class="pPrev pButton"><span class="om-icon om-icon-seek-prev"></span></div></div> ';var S='<div class="pGroup"><div class="pPrev pButton"><span></span></div></div> ';var X='<div class="pGroup"><span class="pageLink"></span></div>';var l='<div class="pGroup"><div class="pNext pButton"><span class="om-icon om-icon-seek-next"></span></div><div class="pLast pButton"><span class="om-icon om-icon-seek-end"></span></div></div>';var K='<div class="pGroup"><div class="pNext pButton"><span></span></div></div>';var U=P.pageText;U=U.replace(/{totalPage}/,"<span>1</span>");U=U.replace(/{index}/,'<input type="text" size="4" value="1" />');var D='<div class="pGroup"><span class="pcontrol">'+U+"</span></span></div>";var o='<div class="pGroup"> <div class="pReload pButton"><span class="om-icon om-icon-refresh"></span></div> </div>';var x='<div class="pGroup"><span class="pPageStat"></span></div>';var E=[P.lazyTotalUrl?S:n,Z,X,Z,P.lazyTotalUrl?K:l,Z,P.lazyTotalUrl?"":D,P.lazyTotalUrl?"":Z,o,Z,x].join("");b("div",T.pDiv).html(E);b(".pReload",T.pDiv).click(function(){T._populate()});b(".pFirst",T.pDiv).click(function(){T._changePage("first")});b(".pPrev",T.pDiv).click(function(){T._changePage("prev")});b(".pNext",T.pDiv).click(function(){T._changePage("next")});b(".pLast",T.pDiv).click(function(){T._changePage("last")});b(".pcontrol input",T.pDiv).keydown(function(g){if(g.keyCode==13){T._changePage("input");g.preventDefault()}});b(".pButton",T.pDiv).hover(function(){b(this).addClass("om-state-hover")},function(){b(this).removeClass("om-state-hover")});if(P.useRp&&!P.autoLimit){var u="",G="";for(var Q=0;Q<P.rpOptions.length;Q++){if(P.limit==P.rpOptions[Q]){G='selected="selected"'}else{G=""}u+="<option value='"+P.rpOptions[Q]+"' "+G+" >"+b.omGrid.lang.perPage+P.rpOptions[Q]+b.omGrid.lang.word_1+"</option>"}b(".pDiv2",T.pDiv).prepend("<div class='pGroup'><select name='rp'>"+u+"</select></div> <div class='btnseparator'></div>");b("select",T.pDiv).change(function(){if(P.onRpChange){P.onRpChange(+this.value)}else{P.newp=1;P.limit=+this.value;T._populate()}})}if(P.searchItems){b(".pDiv2",T.pDiv).prepend("<div class='pGroup'> <div class='pSearch pButton'><span></span></div> </div>  <div class='btnseparator'></div>");b(".pSearch",T.pDiv).click(function(){b(T.sDiv).slideToggle("fast",function(){b(".sDiv:visible input:first",T.gDiv).trigger("focus")})});T.sDiv.className="sDiv om-state-header";var M=P.searchItems;var F="",G="";for(var O=0;O<M.length;O++){if(P.qtype==""&&M[O].isdefault==true){P.qtype=M[O].name;G='selected="selected"'}else{G=""}F+="<option value='"+M[O].name+"' "+G+" >"+M[O].display+"&nbsp;&nbsp;</option>"}if(P.qtype==""){P.qtype=M[0].name}b(T.sDiv).append("<div class='sDiv2'>"+P.findtext+" <input type='text' value='"+P.query+"' size='30' name='q' class='qsbox' />  <select name='qtype'>"+F+"</select></div>");b("input[name=q]",T.sDiv).keydown(function(g){if(g.keyCode==13){T._doSearch()}});b("select[name=qtype]",T.sDiv).keydown(function(g){if(g.keyCode==13){T._doSearch()}});b("input[value=Clear]",T.sDiv).click(function(){b("input[name=q]",T.sDiv).val("");P.query="";T._doSearch()});b(T.bDiv).after(T.sDiv)}}b(T.pDiv,T.sDiv).append("<div style='clear:both'></div>");if(P.title){T.mDiv.className="mDiv om-widget-header";T.mDiv.innerHTML='<div class="ftitle">'+P.title+"</div>";b(T.gDiv).prepend(T.mDiv);if(P.showTableToggleBtn){b(T.mDiv).append('<div class="ptogtitle" title="Minimize/Maximize Table"><span></span></div>');b("div.ptogtitle",T.mDiv).click(function(){b(T.gDiv).toggleClass("hideBody");b(this).toggleClass("vsble")})}}T.cdropleft=document.createElement("span");T.cdropleft.className="cdropleft";T.cdropright=document.createElement("span");T.cdropright.className="cdropright";T.block.className="gBlock";var q=b(T.bDiv).height();b(T.block).append('<div align="center" />');b("div",T.block).css("margin-top",q/2);b("div",T.block).append('<div class="loadingImg" style="display:block"/>');var v=T.bDiv.offsetTop;b(T.block).css({width:T.bDiv.style.width,height:q,background:"white",zIndex:1,left:"0px"});b(T.block).fadeTo(0,P.blockOpacity);if(b("th",T.hDiv).length){T.nDiv.className="nDiv";T.nDiv.innerHTML="<table cellpadding='0' cellspacing='0'><tbody></tbody></table>";b(T.nDiv).css({marginBottom:(q*-1),display:"none",top:v-3}).noSelect();var A=0;b("th div",T.hDiv).each(function(){var p=b(this).parent().attr("axis");if("colcheckbox"==p||"colindex"==p){return}var i=b("th[axis='col"+A+"']",T.hDiv)[0];if(typeof(i)=="undefined"){return}var g='checked="checked"';if(i.style.display=="none"){g=""}b("tbody",T.nDiv).append('<tr><td class="ndcol1"><input type="checkbox" '+g+' class="togCol" value="'+(A++)+'" /></td><td class="ndcol2">'+this.innerHTML+"</td></tr>")});if(b.browser.msie&&b.browser.version<7){b("tr",T.nDiv).hover(function(){b(this).addClass("ndcolover")},function(){b(this).removeClass("ndcolover")})}b("td.ndcol2",T.nDiv).click(function(){if(b("input:checked",T.nDiv).length<=P.minColToggle&&b(this).prev().find("input")[0].checked){return false}return T._toggleCol(b(this).prev().find("input").val())});b("input.togCol",T.nDiv).click(function(){if(b("input:checked",T.nDiv).length<P.minColToggle&&this.checked==false){return false}b(this).parent().next().trigger("click")});b(T.gDiv).prepend(T.nDiv);b(T.nBtn).addClass("nBtn").html("<div></div>").attr("title",b.omGrid.lang.showColumnsMsg).click(function(){b(T.nDiv).toggle();return true});if(P.showToggleBtn){b(T.gDiv).prepend(T.nBtn)}}b(T.iDiv).addClass("iDiv").css({display:"none"});b(T.bDiv).append(T.iDiv);b(T.bDiv).hover(function(){b(T.nDiv).hide();b(T.nBtn).hide()},function(){if(T.multisel){T.multisel=false}});b(T.gDiv).hover(function(){},function(){b(T.nDiv).hide();b(T.nBtn).hide()});b(document).mousemove(function(g){T._dragMove(g)}).mouseup(function(g){T._dragEnd()}).hover(function(){},function(){T._dragEnd()});if(b.browser.msie&&b.browser.version<7){b(".hDiv,.bDiv,.mDiv,.pDiv,.vGrip,.tDiv, .sDiv",T.gDiv).css({width:"100%"});b(T.gDiv).addClass("ie6");if(P.width!="auto"){b(T.gDiv).addClass("ie6fullwidthbug")}}T._rePosDrag();T._fixHeight();N.p=P;N.grid=T;if(P.url&&P.autoLoad){T._populate()}return N};var c=false;b(document).ready(function(){c=true});var a={reload:function(){var d=this[0];if(!d.grid){throw b.omGrid.lang.throw_msg_2;return this}d.grid._populate();return this},refresh:function(){var d=this[0];if(!d.grid){throw b.omGrid.lang.throw_msg_2;return this}if(b(d.grid.block)){b(d.grid.block).css({top:0,left:0});b(d).closest(".om-grid").append(d.grid.block)}d.grid._addData(d.grid.data,"notmodified");return this},repaint:function(){return this},options:function(e){var d=this[0];if(!d.grid||!d.p){throw b.omGrid.lang.throw_msg_2;return this}b.extend(d.p,e);return this},toggleCol:function(f,e){var d=this[0];if(!d.grid){throw b.omGrid.lang.throw_msg_2;return this}d.grid._toggleCol(f,e);return this},setData:function(d){var e=this[0];if(!e.grid){throw b.omGrid.lang.throw_msg_2;return this}if(typeof(d)==="string"){e.p.url=d;e.grid.reload()}else{e.grid.data.total=d.length;e.grid.data.page=d.page?d.page:1;e.grid.data.rows=d;e.grid._addData(e.grid.data,"success")}return this},getData:function(){var d=this[0];if(!d.grid){throw b.omGrid.lang.throw_msg_2;return this}if(d.grid.data){return d.grid.data}return this},appendData:function(d){var e=this[0];if(!e.grid){throw b.omGrid.lang.throw_msg_2;return this}e.grid.data.total+=d.length;e.grid.data.rows=e.grid.data.rows.concat(d);e.grid._addData(e.grid.data,"success");return this},getSelections:function(){var d=this[0];if(!d.grid){throw b.omGrid.lang.throw_msg_2;return this}return d.grid._getSelections()},setSelections:function(f,e){var d=this[0];if(!d.grid){throw b.omGrid.lang.throw_msg_2;return this}d.grid._setSelections(f,e?e:"id");return this}};b.fn.omGrid=function(g){if(g&&typeof(g)=="string"){if(a[g]){try{return a[g].apply(this,Array.prototype.slice.call(arguments,1))}catch(f){var d=f+" cannot invoke the methd:"+g;throw d}}return null}return this.each(function(){if(!c){b(this).hide();var e=this;b(document).ready(function(){b.addFlex(e,g)})}else{b.addFlex(this,g)}})};b.extend(b,{omGrid:{}});b.omGrid.lang={loadingMsg:"正在加载数据，请稍候...",pageText:"共{totalPage}页，第{index}页",emptyMsg:"没有数据",errorMsg:"连接失败",pageStat:"共{total}条数据，显示第{from}条到{to}条",count:"正在计算总数...",perPage:"每页",word_1:"条",throw_msg_1:"不能指定两个autoExpand列!",throw_msg_2:"表格尚未初始化.",showColumnsMsg:"显示列"};b.fn.noSelect=function(e){var d=(e==null)?true:e;if(d){return this.each(function(){if(b.browser.msie||b.browser.safari){b(this).bind("selectstart",function(){return false})}else{if(b.browser.mozilla){b(this).css("MozUserSelect","none");b("body").trigger("focus")}else{if(b.browser.opera){b(this).bind("mousedown",function(){return false})}else{b(this).attr("unselectable","on")}}}})}else{return this.each(function(){if(b.browser.msie||b.browser.safari){b(this).unbind("selectstart")}else{if(b.browser.mozilla){b(this).css("MozUserSelect","inherit")}else{if(b.browser.opera){b(this).unbind("mousedown")}else{b(this).removeAttr("unselectable","on")}}}})}}})(jQuery);